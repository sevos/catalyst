# Story 3.2: Detailed Execution Trace

## Status
Draft

## Story
**As a** Rails Developer,
**I want** to see the detailed, step-by-step trace for an execution,
**so that** I can understand *how* the agent arrived at its result and effectively debug its reasoning process.

## Acceptance Criteria
1. A new `ExecutionStep` `ActiveRecord` model is created to store detailed trace events (thoughts, tool calls, etc.).
2. The core agent execution loop is refactored to create and save these `ExecutionStep` records during a run.
3. The execution show page (from Story 3.1) is enhanced to display the full, chronological list of `ExecutionStep` records below the input/output summary.
4. The page's real-time updates are enhanced to stream in new `ExecutionStep` records for in-progress tasks.

## Tasks / Subtasks

- [ ] Create ExecutionStep model (AC: 1)
  - [ ] Generate ExecutionStep ActiveRecord model
  - [ ] Add fields for step type, content, timestamp
  - [ ] Create migration and associations to Execution
- [ ] Refactor agent execution loop (AC: 2)
  - [ ] Add step logging to agent execution
  - [ ] Create ExecutionStep records for thoughts, tool calls, results
  - [ ] Maintain chronological order of steps
- [ ] Enhance execution show page (AC: 3)
  - [ ] Add ExecutionStep display to show view
  - [ ] Show chronological list of steps
  - [ ] Display step type, content, and timestamp
- [ ] Add real-time step streaming (AC: 4)
  - [ ] Implement Hotwire streaming for new steps
  - [ ] Update show page dynamically as steps are created
  - [ ] Handle streaming for in-progress executions

## Dev Notes

**Relevant Source Tree info:**
- ExecutionStep model at `/app/models/catalyst/execution_step.rb`
- Agent execution loop in `/app/models/catalyst/agent.rb`
- Show view at `/app/views/catalyst/executions/show.html.erb`
- Real-time streaming requires Hotwire Turbo streams

**Important notes:**
- This depends on Story 3.1 (Basic Execution Monitoring)
- Provides crucial debugging and observability
- Real-time streaming enables live monitoring
- Step-by-step traces help understand agent reasoning

### Testing
- Test file location: `/test/models/catalyst/` for model tests, `/test/controllers/catalyst/` for view tests
- Test standards: Test step creation, chronological ordering, real-time updates
- Testing frameworks: Use Rails minitest with Hotwire testing
- Specific requirements: Test step logging, streaming functionality, chronological display

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-08 | 1.0 | Initial story creation | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
*To be populated by development agent*

### Debug Log References
*To be populated by development agent*

### Completion Notes List
*To be populated by development agent*

### File List
*To be populated by development agent*

## QA Results
*To be populated by QA agent*