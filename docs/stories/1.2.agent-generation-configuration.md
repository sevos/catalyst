# Story 1.2: Agent Generation & Configuration

## Status
Draft

## Story
**As a** Rails Developer,
**I want** to use a generator to create either simple or advanced Agent classes with their prompt templates,
**so that** I can quickly start defining AI agents ranging from basic to highly customized types.

## Acceptance Criteria
1. Running `rails g catalyst:agent MyAgent` creates a simple agent class at `app/ai/my_agent.rb` inheriting from `ApplicationAgent`.
2. The generator creates a corresponding prompt template at `app/ai/prompts/my_agent.md.erb`.
3. Simple agents inherit from `ApplicationAgent` and use its `role`, `goal`, and `backstory` attributes.
4. Running `rails g catalyst:agent MarketingAgent --custom-attributes campaign_type:string product_id:integer` creates a custom delegated type with migration.
5. Custom agents include `Catalyst::Agentable` and are automatically registered in `config/initializers/catalyst.rb`.

## Tasks / Subtasks

- [ ] Create simple agent generation (AC: 1, 2, 3)
  - [ ] Generate simple agent class template inheriting from ApplicationAgent
  - [ ] Place generated file in app/ai/ directory
  - [ ] Create prompt template ERB file in app/ai/prompts/
  - [ ] Include role, goal, backstory variables in template
- [ ] Create custom agent generation (AC: 4, 5)
  - [ ] Parse --custom-attributes argument with type notation
  - [ ] Generate custom agent model with include Catalyst::Agentable
  - [ ] Create migration with custom attributes and appropriate column types
  - [ ] Generate prompt template for custom agent
  - [ ] Update config/initializers/catalyst.rb to register new delegated type
- [ ] Create unified catalyst:agent generator
  - [ ] Implement generator logic with --custom-attributes detection
  - [ ] Add validation for attribute format (name:type)
  - [ ] Support standard Rails column types (string, integer, text, json, etc.)
  - [ ] Follow Rails generator naming conventions

## Dev Notes

**Relevant Source Tree info:**
- Base Agent class should be at `/app/models/catalyst/agent.rb`
- Generator should be at `/lib/generators/catalyst/agent/agent_generator.rb`
- Generator templates should be in `/lib/generators/catalyst/agent/templates/`
- Host application agents will be at `app/ai/`
- Custom agent migrations will be generated in `db/migrate/`
- Catalyst initializer at `config/initializers/catalyst.rb`

**Important notes:**
- This builds on Story 1.1 (Core Models & Installation)
- Simple agents inherit from ApplicationAgent (already exists from Story 1.1)
- Custom agents use delegated types pattern with Catalyst::Agentable module
- Generator should follow Rails naming conventions
- Prompt templates should support ERB for dynamic content
- Custom attributes support standard Rails column types
- Automatic registration in initializer prevents manual configuration

### Testing
- Test file location: `/test/generators/catalyst/agent/` for generator tests
- Test standards: Test both simple and custom agent generation
- Testing frameworks: Use Rails generator testing utilities
- Specific requirements: 
  - Test simple agent creation (inheritance from ApplicationAgent)
  - Test custom agent creation with --custom-attributes
  - Test migration generation with correct column types
  - Test initializer registration for custom agents
  - Test prompt template generation for both variants
  - Test file creation, content, and naming conventions

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-08 | 1.0 | Initial story creation | Sarah (PO) |
| 2025-07-09 | 2.0 | Enhanced scope: added custom agent generation with --custom-attributes | Bob (SM) |

## Dev Agent Record

### Agent Model Used
*To be populated by development agent*

### Debug Log References
*To be populated by development agent*

### Completion Notes List
*To be populated by development agent*

### File List
*To be populated by development agent*

## QA Results
*To be populated by QA agent*