# Story 1.3: Default LLM Adapter & Basic Execution

## Status
Draft

## Story
**As a** Rails Developer,
**I want** the framework to have a default, configurable LLM adapter (e.g., for OpenAI),
**so that** my agent can execute a simple prompt and get a response.

## Acceptance Criteria
1. The framework provides an adapter for at least one major LLM provider (e.g., OpenAI).
2. The API key is configured securely using standard Rails credentials.
3. An agent instance can be called with a prompt, which creates an `Execution` record.
4. The framework constructs the final system prompt and sends it to the configured LLM API.
5. The raw text response from the LLM is successfully saved to the `Execution` record.

## Tasks / Subtasks

- [ ] Create LLM adapter interface (AC: 1)
  - [ ] Define base LLM adapter class
  - [ ] Create OpenAI adapter implementation
  - [ ] Add configuration for LLM provider selection
- [ ] Implement secure API key configuration (AC: 2)
  - [ ] Add OpenAI API key to Rails credentials
  - [ ] Create configuration access methods
  - [ ] Add error handling for missing credentials
- [ ] Add agent execution capability (AC: 3)
  - [ ] Add execute method to Agent class
  - [ ] Create Execution record on agent call
  - [ ] Link Execution to Agent instance
- [ ] Implement prompt construction (AC: 4)
  - [ ] Build system prompt from agent configuration
  - [ ] Combine role, goal, backstory with user prompt
  - [ ] Send constructed prompt to LLM API
- [ ] Store LLM response (AC: 5)
  - [ ] Save raw response to Execution record
  - [ ] Update Execution status appropriately
  - [ ] Handle API errors gracefully

## Dev Notes

**Relevant Source Tree info:**
- LLM adapters should be at `/app/services/catalyst/llm/`
- Agent execution logic should be in `/app/models/catalyst/agent.rb`
- Configuration should use standard Rails credentials system
- Service objects should handle API interactions

**Important notes:**
- This depends on Story 1.1 (Core Models) and Story 1.2 (Agent Generation)
- OpenAI adapter should be the default implementation
- Error handling is crucial for API reliability
- Execution status should be updated throughout the process

### Testing
- Test file location: `/test/services/catalyst/llm/` for adapters, `/test/models/catalyst/` for agent tests
- Test standards: Mock external API calls, test error scenarios
- Testing frameworks: Use Rails minitest with webmock for API mocking
- Specific requirements: Test successful execution, API failures, credential errors

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-08 | 1.0 | Initial story creation | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
*To be populated by development agent*

### Debug Log References
*To be populated by development agent*

### Completion Notes List
*To be populated by development agent*

### File List
*To be populated by development agent*

## QA Results
*To be populated by QA agent*